#!/bin/bash

# üöÄ –ë–´–°–¢–†–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï PAGKITE –ò WEBHOOK
# –ü—Ä–æ—Å—Ç–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

echo "üöÄ –ë–´–°–¢–†–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï PAGKITE –ò WEBHOOK"
echo "=" * 50

# 1. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
echo "‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤..."
pkill -f webhook.py
pkill -f pagekite.py
pkill -f main.py
sleep 3

# 2. –ó–∞–ø—É—Å–∫ webhook —Å–µ—Ä–≤–µ—Ä–∞
echo "üöÄ –ó–∞–ø—É—Å–∫ webhook —Å–µ—Ä–≤–µ—Ä–∞..."
python3 webhook.py &
WEBHOOK_PID=$!
sleep 3

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook
echo "üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook..."
curl -s http://localhost:5000/health
echo ""

# 4. –ó–∞–ø—É—Å–∫ PageKite
echo "üåê –ó–∞–ø—É—Å–∫ PageKite..."
./pagekite.py 5000 dashastar.pagekite.me &
PAGKITE_PID=$!
sleep 10

# 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ PageKite
echo "üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ PageKite..."
curl -s https://dashastar.pagekite.me/health
echo ""

# 6. –°—Ç–∞—Ç—É—Å
echo "üìù –°—Ç–∞—Ç—É—Å:"
echo "   - Webhook PID: $WEBHOOK_PID"
echo "   - PageKite PID: $PAGKITE_PID"
echo "   - –õ–æ–∫–∞–ª—å–Ω—ã–π: http://localhost:5000"
echo "   - –£–¥–∞–ª–µ–Ω–Ω—ã–π: https://dashastar.pagekite.me"

echo ""
echo "‚úÖ –ë–´–°–¢–†–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û!"
echo ""
echo "üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:"
echo "   python3 check_webhook_status.py"
echo "   python3 test_post_webhook.py"
