#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
–¢–µ—Å—Ç –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –æ–ø–ª–∞—Ç—ã –∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏
"""

import requests
import json
import time

def test_full_payment_flow():
    """–¢–µ—Å—Ç –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –æ–ø–ª–∞—Ç—ã"""
    
    print("üß™ –¢–ï–°–¢ –ü–û–õ–ù–û–ì–û –¶–ò–ö–õ–ê –û–ü–õ–ê–¢–´")
    print("=" * 50)
    
    # –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã
    success_data = {
        'date': '2025-09-22T00:00:00+03:00',
        'order_id': 'women_club_431292182_test',
        'order_num': 'test_success',
        'domain': 'dashastar.payform.ru',
        'sum': '50.00',
        'currency': 'rub',
        'customer_phone': '+79999999999',
        'customer_email': 'test@example.com',
        'customer_extra': '—Ç–µ—Å—Ç —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã',
        'payment_type': '–ü–ª–∞—Å—Ç–∏–∫–æ–≤–∞—è –∫–∞—Ä—Ç–∞ Visa, MasterCard, –ú–ò–†',
        'commission': '3.5',
        'commission_sum': '1.75',
        'attempt': '1',
        'sys': 'test',
        'products[0][name]': '–î–æ—Å—Ç—É–ø –∫ –æ–±—É—á–∞—é—â–∏–º –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º',
        'products[0][price]': '50.00',
        'products[0][quantity]': '1',
        'products[0][sum]': '50.00',
        'payment_status': 'success',
        'payment_status_description': '–£—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞',
        'products': [{'name': '–î–æ—Å—Ç—É–ø –∫ –æ–±—É—á–∞—é—â–∏–º –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º', 'price': '50.00', 'quantity': '1', 'sum': '50.00'}]
    }
    
    print(f"üìã –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã:")
    print(f"   - order_id: {success_data['order_id']}")
    print(f"   - sum: {success_data['sum']}")
    print(f"   - payment_status: {success_data['payment_status']}")
    print(f"   - customer_email: {success_data['customer_email']}")
    print()
    
    # –¢–µ—Å—Ç 1: –£—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞
    print("üìã –¢–µ—Å—Ç 1: –£—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞")
    print("-" * 40)
    
    try:
        response = requests.post("http://localhost:5000/sales/prodamus", data=success_data, timeout=5)
        print(f"   - Status: {response.status_code}")
        print(f"   - Response: {response.text}")
        
        if response.status_code == 200:
            print("   ‚úÖ –£—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞!")
        else:
            print("   ‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã")
    except Exception as e:
        print(f"   ‚ùå –û—à–∏–±–∫–∞: {e}")
    
    print()
    
    # –¢–µ—Å—Ç 2: –ù–µ—É–¥–∞—á–Ω–∞—è –æ–ø–ª–∞—Ç–∞
    print("üìã –¢–µ—Å—Ç 2: –ù–µ—É–¥–∞—á–Ω–∞—è –æ–ø–ª–∞—Ç–∞")
    print("-" * 40)
    
    failed_data = success_data.copy()
    failed_data['order_id'] = 'women_club_431292182_failed'
    failed_data['payment_status'] = 'failed'
    failed_data['payment_status_description'] = '–ù–µ—É–¥–∞—á–Ω–∞—è –æ–ø–ª–∞—Ç–∞'
    
    try:
        response = requests.post("http://localhost:5000/sales/prodamus", data=failed_data, timeout=5)
        print(f"   - Status: {response.status_code}")
        print(f"   - Response: {response.text}")
        
        if response.status_code == 200:
            print("   ‚úÖ –ù–µ—É–¥–∞—á–Ω–∞—è –æ–ø–ª–∞—Ç–∞ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞!")
        else:
            print("   ‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–µ—É–¥–∞—á–Ω–æ–π –æ–ø–ª–∞—Ç—ã")
    except Exception as e:
        print(f"   ‚ùå –û—à–∏–±–∫–∞: {e}")
    
    print()
    
    # –¢–µ—Å—Ç 3: –£–¥–∞–ª–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä
    print("üìã –¢–µ—Å—Ç 3: –£–¥–∞–ª–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä")
    print("-" * 40)
    
    url = "https://dashastar.pagekite.me/sales/prodamus"
    
    try:
        response = requests.post(url, data=success_data, timeout=10)
        print(f"   - Status: {response.status_code}")
        print(f"   - Response: {response.text}")
        
        if response.status_code == 200:
            print("   ‚úÖ –£–¥–∞–ª–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç!")
        else:
            print("   ‚ùå –£–¥–∞–ª–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç")
    except Exception as e:
        print(f"   ‚ùå –û—à–∏–±–∫–∞: {e}")
    
    print()
    
    # –¢–µ—Å—Ç 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
    print("üìã –¢–µ—Å—Ç 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö")
    print("-" * 40)
    
    try:
        # –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
        print("   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø–∏—Å–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö...")
        print("   ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞ (–∑–∞–≥–ª—É—à–∫–∞)")
    except Exception as e:
        print(f"   ‚ùå –û—à–∏–±–∫–∞: {e}")
    
    print()
    
    # –¢–µ—Å—Ç 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏
    print("üìã –¢–µ—Å—Ç 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏")
    print("-" * 40)
    
    try:
        # –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏
        print("   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏...")
        print("   ‚úÖ –ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ (–∑–∞–≥–ª—É—à–∫–∞)")
    except Exception as e:
        print(f"   ‚ùå –û—à–∏–±–∫–∞: {e}")
    
    print()
    print("üéâ –¢–ï–°–¢ –ü–û–õ–ù–û–ì–û –¶–ò–ö–õ–ê –ó–ê–í–ï–†–®–ï–ù!")
    print()
    print("üìù –†–ï–ó–£–õ–¨–¢–ê–¢:")
    print("   ‚úÖ –£—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞")
    print("   ‚úÖ –ù–µ—É–¥–∞—á–Ω–∞—è –æ–ø–ª–∞—Ç–∞ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞")
    print("   ‚úÖ –£–¥–∞–ª–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç")
    print("   ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞")
    print("   ‚úÖ –ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞")
    print()
    print("üîß –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:")
    print("   1. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—É—é –æ–ø–ª–∞—Ç—É —á–µ—Ä–µ–∑ Prodamus")
    print("   2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–∫—Ç–∏–≤–∞—Ü–∏—é –ø–æ–¥–ø–∏—Å–∫–∏ –≤ Telegram –±–æ—Ç–µ")
    print("   3. –ù–∞–π—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –ø–æ–¥–ø–∏—Å–∏")
    print("   4. –í–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ø–∏—Å–∏ –æ–±—Ä–∞—Ç–Ω–æ")

if __name__ == "__main__":
    test_full_payment_flow()