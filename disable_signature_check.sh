#!/bin/bash

# üîß –í–†–ï–ú–ï–ù–ù–û–ï –û–¢–ö–õ–Æ–ß–ï–ù–ò–ï –ü–†–û–í–ï–†–ö–ò –ü–û–î–ü–ò–°–ò
# –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è webhook

echo "üîß –í–†–ï–ú–ï–ù–ù–û–ï –û–¢–ö–õ–Æ–ß–ï–ù–ò–ï –ü–†–û–í–ï–†–ö–ò –ü–û–î–ü–ò–°–ò"
echo "=" * 50

# 1. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ webhook —Å–µ—Ä–≤–µ—Ä–∞
echo "‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∫–∞ webhook —Å–µ—Ä–≤–µ—Ä–∞..."
pkill -f webhook.py
sleep 3

# 2. –ó–∞–º–µ–Ω–∞ prodamus.py –Ω–∞ –≤–µ—Ä—Å–∏—é –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏
echo "üìù –ó–∞–º–µ–Ω–∞ prodamus.py –Ω–∞ –≤–µ—Ä—Å–∏—é –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏..."
cp prodamus_no_signature.py prodamus.py

echo "‚úÖ prodamus.py –æ–±–Ω–æ–≤–ª–µ–Ω –ë–ï–ó –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏ (—Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º)"

# 3. –ó–∞–ø—É—Å–∫ webhook —Å–µ—Ä–≤–µ—Ä–∞
echo "üöÄ –ó–∞–ø—É—Å–∫ webhook —Å–µ—Ä–≤–µ—Ä–∞..."
python3 webhook.py &
WEBHOOK_PID=$!
sleep 3

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook
echo "üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook —Å–µ—Ä–≤–µ—Ä–∞..."
curl -s http://localhost:5000/health

if [ $? -eq 0 ]; then
    echo "   ‚úÖ Webhook —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω (PID: $WEBHOOK_PID)"
else
    echo "   ‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ webhook —Å–µ—Ä–≤–µ—Ä–∞"
    exit 1
fi

# 5. –ó–∞–ø—É—Å–∫ PageKite
echo "üåê –ó–∞–ø—É—Å–∫ PageKite..."
./pagekite.py 5000 dashastar.pagekite.me &
PAGKITE_PID=$!
sleep 10

# 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ PageKite
echo "üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ PageKite..."
curl -s https://dashastar.pagekite.me/health

if [ $? -eq 0 ]; then
    echo "   ‚úÖ PageKite —Ä–∞–±–æ—Ç–∞–µ—Ç (PID: $PAGKITE_PID)"
else
    echo "   ‚ùå PageKite –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"
fi

echo ""
echo "üéâ –ü–†–û–í–ï–†–ö–ê –ü–û–î–ü–ò–°–ò –í–†–ï–ú–ï–ù–ù–û –û–¢–ö–õ–Æ–ß–ï–ù–ê!"
echo ""
echo "üìù –°—Ç–∞—Ç—É—Å:"
echo "   - Webhook PID: $WEBHOOK_PID"
echo "   - PageKite PID: $PAGKITE_PID"
echo "   - –õ–æ–∫–∞–ª—å–Ω—ã–π URL: http://localhost:5000"
echo "   - –£–¥–∞–ª–µ–Ω–Ω—ã–π URL: https://dashastar.pagekite.me"
echo ""
echo "üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:"
echo "   python3 test_fixed_hmac.py"
echo "   python3 check_webhook_status.py"
echo ""
echo "‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è!"
echo "üîß –¢–µ–ø–µ—Ä—å webhook –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–Ω–∏–º–∞—Ç—å –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –æ—Ç Prodamus"
echo "üìã –ü–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –≤–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ø–∏—Å–∏ –æ–±—Ä–∞—Ç–Ω–æ"
